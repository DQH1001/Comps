<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>layui</title>
  		<meta name="renderer" content="webkit">
 		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
 		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 		<link rel="stylesheet" href="../../assets/layui/css/layui.css"/>
 		<link href="../../js/dropzone/css/dropzone.css" rel="stylesheet"/>
<script type="text/javascript" src="../../js/jquery-3.1.1.js" charset="utf-8"></script>
<script type="text/javascript" src="../../assets/layui/layui.js" charset="utf-8"></script>
<script src="../../js/bootstrap.min.js"></script>	
<script src="../../js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="../../js/jquery-migrate-1.2.1.min.js"></script>	
<!--file upload-->
<script type="text/javascript" src="../../js/bootstrap-fileupload.min.js"></script>
<script src="../../js/jquery.form.js" type="text/javascript"></script>
    <link href="../../js/layer.css" rel="stylesheet">
<!--dropzone-->
<script src="../../js/dropzone/dropzone.js"></script>
	<script src="../../js/layer.js"></script>
	</head>
<body>
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
  		<legend>企业注册</legend>
	</fieldset>
	<div class="layui-tab" align="center" style="">
	<form class="layui-form" action="#"  lay-filter="test"
	id="form2" enctype="multipart/form-data">
	  <div class="layui-form-item">
	    <label class="layui-form-label">企业名称</label>
	    <div class="layui-input-block">
	      <input type="text" name="cname" lay-verify="title" autocomplete="off" placeholder="请输入您的企业名称" class="layui-input">
	    </div>
	  </div>
	  <div class="layui-form-item">
	    <label class="layui-form-label">法定代表人</label>
	    <div class="layui-input-block">
	      <input type="text" name="cusername" lay-verify="required" lay-reqtext="法定代表人都没，你算个公司？？？" placeholder="请输入法定代表人" autocomplete="off" class="layui-input">
	    </div>
	  </div>  
	 
	  <div class="layui-form-item">
	    <label class="layui-form-label">企业专业</label>
	   <!-- <span id="prolist2"> </span> -->
	    <div class="layui-input-block" id="prolist1">
	     
	    </div>
	  </div>
	  
	  <div class="layui-form-item layui-form-text">
	    <label class="layui-form-label">企业说明</label>
	    <div class="layui-input-block">
	      <textarea placeholder="请输入内容" class="layui-textarea" name="cdetail"></textarea>
	    </div>
	  </div>

	 <input type="hidden" value="abst" name="uname" />
	  <div class="layui-form-item layui-row" style="width: 1000px;">
	  	<label class="layui-form-label">企业logo</label>
	  	<div class="layui-upload" style="width: 1000px;">
	  		<!--  layui-circle  <a id="demoText"></a>
	  				id="test1" 
	  		-->
	  		<img class="layui-upload-img"  onclick="openImg()" id="showImg"
	  			 width="300" height="150" style="display: none;">              
	  		<button type="button" class="layui-btn" id="test1">Blose</button>
	  	</div> 
	  </div>
	  <div class="layui-form-item layui-row">
	  	<label class="layui-form-label">企业介绍</label>
	    <div class="layui-input-inline">
                                <button style="float: left;" type="button" class="layui-btn layui-btn-warm" id="layuiadmin-upload-book-list">点击上传书籍</button>&nbsp;
                            </div>
                            <!-- 
                            <textarea rows="2" cols="10" id="preview2"></textarea> -->
                            <div id="preview1" class="layui-input-inline">
                            <input type="hidden" id="hitxt" value="" />
         <input type="button" class="layui-btn layui-btn-warm" value="预览txt" onclick="openTxt()" style="margin-left: 100px">      
          
                            </div>
	  </div>
	  <div class="layui-form-item layui-row">
	  	<label class="layui-form-label">宣传视频</label>
        <input name="classVideo" id="videourl"  value="" autocomplete="off" class="layui-input" type="hidden">
        
        <div class=" layui-upload-drag" id="video" style="border-left: 0px;" type="video">
            <i class="layui-icon">&#xe654;</i>
            <p>点击上传</p>
            <video src="" id="demo9" style="position: absolute;height: 137px;width: 137px;margin: -106px auto auto -60px;"></video>
          
        </div>  
         <input type="hidden" id="hivideo" value="" />
         <input type="button" class="layui-btn layui-btn-warm" value="预览" onclick="openVideo()" style="margin-left: 180px">      
         <span  style="margin-left: 150px"><input type="radio" name="ctvchoose" value="1" title="宣传视频" checked=""></span>
	  </div>
	  <div class="layui-form-item layui-row">
	  	<label class="layui-form-label">多图宣传:</label>
		<div class="layui-upload">
			<button type="button" class="layui-btn" id="test2">多图片上传</button>
			<span  style="margin-left: 410px"><input type="radio" name="ctvchoose" value="2" title="多图宣传"></span>
			<blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px; margin-left: 110px;">
				预览图：
				<div class="layui-upload-list" id="demo2"></div>
				</blockquote>
		</div>
	  </div>
  
	  <div class="layui-form-item">
	    <div class="layui-input-block">
	                                                        <!-- submit(demo2) -->
	      <button class="layui-btn" lay-submit="" id="btnSub" type="button" lay-filter="demo2">立即提交</button>
	      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
	    </div>
	  </div>
	</form>
	</div>

	<script type="text/javascript">	
        function openImg() {
			var idBar = '#showImg';
			var src = $(idBar)[0].src;
			var width = $(idBar).width();
			var height = $(idBar).height();
			var scaleWH = width / height;
			var bigH = 550;
			var bigW = scaleWH * bigH;
			if (bigW > 1000) {
				bigW = 1000;
				bigH = bigW / scaleWH;
			}
			// 放大预览图片
			parent.layer.open({
				type: 1,
				title: false,
				closeBtn: 1,
				shadeClose: true,
				area: [bigW + 'px', bigH + 'px'], //宽高
				content: '<img width="' + bigW + '" src="' + src + '" />'
			});
		}
        function openTxt() {
            var classVideo = document.getElementById("videourl").value;
            var index = layer.open({
                type: 2,
                content: $('#hitxt').val(),
                	//'/uploadFiles/goLook?classVideo='+classVideo,
                area: ['600px', '450px'],
                offset:'t',
                maxmin: true,
                end: function () {

                }
            });
        }
        function openVideo() {
            var classVideo = document.getElementById("videourl").value;
            var index = layer.open({
                type: 2,
                content: $('#hivideo').val(),
                	//'/uploadFiles/goLook?classVideo='+classVideo,
                area: ['600px', '450px'],
                offset:'t',
                maxmin: true,
                end: function () {

                }
            });
        }
		layui.use('upload', function(){
			var $ = layui.jquery,
			upload = layui.upload;
			//<img class="layui-upload-img"  onclick="openImg()" id="showImg"
	  		//	 width="300" height="150" style="display: none;">              
	  		//<button type="button" class="layui-btn" id="test1">Blose</button>
			//普通图片上传,绑定点击button显示加载图片的提示框，type=file效果
			var uploadInst = upload.render({
				elem: '#test1',
				url: 'user/upload.action',
				auto: false, //不自动上传
				before: function(obj){
					//before如果不自动上传，函数没有意义
					obj.preview(function(index, file, result){						
						$('#showImg').attr('src', result); //图片链接（base64）
					});
				},
				choose: function (obj) {
					//choose如果不自动上传，那么choose是有价值的
					//预读本地文件，也就是type=file的效果
					obj.preview(function (index, file, result) {
						$('#showImg').css('display','block').attr('src', result);
						//$('#test1').css('display','none');
					})
				}
				//,done: function(res){					
				//}
				,error: function(){
					 alert("上传失败");
					//演示失败状态，并实现重传
					//var demoText = $('#demoText');
					//demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
					//demoText.find('.demo-reload').on('click', function(){
						//uploadInst.upload();
					//});
				}
			});			
			//多图片上传
			upload.render({
				elem: '#test2',
				url: 'user/upload.action',
				multiple: true,
				auto: false, 
				choose: function (obj) {
					//预读本地文件 上传几个图片，就执行几次choose函数
					obj.preview(function (index, file, result) {
					   $('#demo2').append('<img src="'+ result +'" alt="'+ file.name +'" width="100" height="100" class="layui-upload-img">');
					})
				},
				before: function(obj){
					//预读本地文件示例，不支持ie8
					obj.preview(function(index, file, result){
						$('#demo2').append('<img src="'+ result +'" alt="'+ file.name +'" width="100" height="100" class="layui-upload-img">')
					});
				},
				done: function(res){
					//上传完毕
				}
			});
			 //上传视频
            var uploadInst=upload.render({
                elem: '#video'
                ,url: '/'
                ,field:"file",//****  如果不是普通image图片上传，那么二进制服务器能够识别那么field属性不能为null
                //,data:{"dir":"media"}
                auto: false, 
                accept: 'video' ,//视频
                choose:function(obj){                	
                	obj.preview(function (index, file, result) {
                		//alert(index+" * "+file+" * "+result);
                		var url = URL.createObjectURL(file);//把file转成URL
                		$('#hivideo').val(url);
                		//alert(url+" url");
                    	$('#demo9').css('display','block').attr('src', url); //视频链接
    		        	var timer = setTimeout(function(){
    		        		layer.close(layer.index);
    		        		//$('#add').css("visibility","visible"); //一开始先将确认上传按钮隐藏，得到视频时长后才开放	
    		        		clearTimeout(timer);
    		        	},1000);
                	})
                	layer.load(); //上传loading
                }
                ,done: function(res){               
                        //$("#videourl").val(res.url);
                        //                       
                }
                ,error:function () {
                    
                }
            });
			upload.render({
	            elem: '#layuiadmin-upload-book-list'
	            , url: '/'
	            , accept: 'file'
	            , field: 'file'//后台接收参数名，如果多个不是image的二进制文件一同上传，那么field属性名字必须一致
	            , acceptMime: 'text/plain'
	           	,auto: false 
	            ,choose: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
	                layer.load(); //上传loading，不是image上传二进制，layui还需要加
	                //alert(998);
	                obj.preview(function (index, file, result) {
	                	//如果查看txt or video那么需要文件流转换为url获取地址
		                var url = URL.createObjectURL(file);//把file转成URL
		                //url地址存在隐藏域中，目的点击的时候从隐藏域
	            		$('#hitxt').val(url);
	            		
			        	var timer = setTimeout(function(){
			        		layer.close(layer.index);
			        		//$('#add').css("visibility","visible"); //一开始先将确认上传按钮隐藏，得到视频时长后才开放	
			        		clearTimeout(timer);
			        	},1000);
	                })					
	            }			    
	            , done: function (res) {
	                //layer.closeAll('loading'); //关闭loading
	                //if(res.data.bookId == ""){
	                    //layer.msg("上传失败，请检查txt重新上传", {icon: 5});
	               // }else {
	                   // $("#bookId_add").val(res.data.bookId)
	                   // $("#preview").show()
	                //}
	            }
	            ,error: function(index, upload){
	               // layer.closeAll('loading'); //关闭loading
	                //layer.msg("上传失败，请检查txt重新上传", {icon: 5});
	            }
	        });
		});
		
		layui.use(['form','jquery','layedit', 'laydate'], function(){
		  var form = layui.form,
		  layer = layui.layer,
		  layedit = layui.layedit,
		  laydate = layui.laydate,
		  $ = layui.jquery;
		  //admin=layui.admin;		  
		  //日期
		  laydate.render({
		    elem: '#date'
		  });
		  laydate.render({
		    elem: '#date1'
		  });		  
		  //创建一个编辑器
		  var editIndex = layedit.build('LAY_demo_editor');
		  selectOpt();
		  function selectOpt(){			  
			  $.ajax({
					url:"../../coms/prolist.action",
					method:"post",
					dataType:"json",	
					async:false,
					success:function(data){	
						var t="";
						$.each(data,function(i){
							///alert(data[i].id+" -  "+data[i].username);
			t+="<input type='checkbox' value='"+data[i].pid+"' name='c_pros' title='"+data[i].pname+"' />";
						})
						//alert(t);
				       $("#prolist1").html(t);
					},
				    error:function(){
				    	alert("eerr");
				    }
			  });			  
		  }
		  form.render();
	      form.render('div' ,'test'); //刷新select选择框渲染
		  //自定义验证规则
		  form.verify({
		    title: function(value){
		      if(value.length < 2 ){
		        return '请输入不小于两个字符的内容';
		      }
		    },
		    pass: [
		      /^[\S]{6,12}$/
		      ,'密码必须6到12位，且不能出现空格'
		    ],
		    content: function(value){
		      layedit.sync(editIndex);
		    }
		  });
		  
		  //监听指定开关
		  form.on('switch(switchTest)', function(data){
		    layer.msg('开关checked：'+ (this.checked ? 'true' : 'false'), {
		      offset: '6px'
		    });
		    layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
		  });
		  
		  //监听提交
		  form.on('submit(demo1)', function(data){
		    layer.alert(JSON.stringify(data.field), {
		      title: '最终的提交信息'
		    })
		    
		    document.getElementById("form1").style.display="none";
		    document.getElementById("form2").style.display="block";
		    
		    return false;
		  });
		  
		 //监听提交
		  form.on('submit(demo2)', function(data){
		    //layer.alert(JSON.stringify(data.field), {
		     // title: '最终的提交信息'
		   // })    
		    //addRecharge(data.field);
		    var foData=new FormData($("#form2")[0]);
		    var chk_value =[];//定义一个数组    
            $('input[name="c_pros"]:checked').each(function(){//遍历每一个名字为interest的复选框，其中选中的执行函数    
               chk_value.push($(this).val());//将选中的值添加到数组chk_value中    
            });		   
		   // alert("demo2: "+chk_value+" - "+foData);
		    $("#form2").ajaxSubmit({
		    			url: "../../coms/upload.action",    //批量固定路径上传
		    		    type: 'POST',  
		    		    data: foData, 
		    	        //cache: false,  
		    	        //contentType: false,
		    	        //processData: false,  
		    		    dataType: "text",   //返回的异步数据格式为不能json，必须是文本格式
		    		    success:function(data){
		    		    	if(data.indexOf("ok")!=-1){
		    		    		layer.msg("insert OK!");
		    		    	}else{
		    		    		layer.msg("insert sorry");
		    		    	}
		    			},
		    		    error:function(){
		    		    	alert("eerr9");
		    		    }
		    		});
		    // return false;
		  });		 
		});
	</script>
	</body>
</html>
